(()=>{var h=i=>{let s=()=>`otsb-popup-${i.sectionId}`,p=()=>`ot-popupDesignMode-${i.sectionId}`,d=()=>localStorage.getItem(p())||"full",m=e=>localStorage.setItem(p(),e),f=Shopify.designMode?"full":"hidden",c=(e,o=!1)=>{let n=localStorage.getItem(s());n||(n="{}");let t;try{t=JSON.parse(n),t.show=e}catch{t={show:e}}o&&(t.ttl=Date.now()+i.delayDays*24*60*60*1e3),localStorage.setItem(s(),JSON.stringify(t))},u=()=>{let e=localStorage.getItem(s());if(e)try{return JSON.parse(e)}catch{return{show:"full"}}return{show:"full"}},{onClose:S,onInit:w,onLoad:g,onOpen:y,onCloseMinimal:v,onClickMinimal:b,...l}=i,M=function(){if(!this)return;let o=(()=>{let n=window.scrollY||document.documentElement.scrollTop,t=window.innerHeight,a=document.documentElement.scrollHeight;n/(a-t)*100>=(i?.scroll_down_percentage||50)&&(this.open.call(this),window.removeEventListener("scroll",o))}).bind(this);window.addEventListener("scroll",o)},r={getPopupStateStorageKey:s,getPopupStateFromStorage:u,putPopupStateToStorage:c,setDesignModePopupState:m,getDesignModePopupState:d,getDesignModePopupStateStorageKey:p};return{isShow:function(){return this.show==="full"},show:f,delayDays:i.delayDays||0,popupLocked:!1,init:function(){if(document.addEventListener("otsb-popup-lock",e=>this.popupLocked=e.detail.lock),Shopify.designMode){this.open();let e=this,o=(n,t=null)=>{n.detail&&n.detail.sectionId.includes(i.sectionId)||t?window.Alpine?e.open():document.addEventListener("alpine:initialized",()=>{e.open()}):window.Alpine?e.hide():document.addEventListener("alpine:initialized",()=>{e.hide()})};document.addEventListener("shopify:section:select",o),document.addEventListener("shopify:block:select",o)}w?.(this,l,r)},load:function(){if(window.location.pathname==="/challenge"||g?.(this,l,r)===!0)return;if((i.trigger||"delay_x_second")==="delay_x_second"){setTimeout(this.open.bind(this),i.delays*1e3);return}M.call(this)},open(){if(y?.(this,l,r)===!0||!Shopify.designMode&&this.show==="hidden"&&this.isPopupClosedStillAlive())return;let e=i.showMinimal&&i.default_style==="minimal"&&window.innerWidth>=768,o=i.showMinimalMobile&&i.default_style_mobile==="minimal"&&window.innerWidth<768;if(e||o){this.minimize();return}if(i.showPopupOnMobile&&window.innerWidth<768||window.innerWidth>=768){if(Shopify.designMode){this.showFull();return}let t=u();this.show=t.show;return}this.hide()},close:function(){if(this.popupLocked||(Alpine.store("otsb_xModal")?.removeFocus(),S?.(this,l,r)===!0))return;let e=i.showMinimal&&window.innerWidth>=768,o=i.showMinimalMobile&&window.innerWidth<768;e||o?requestAnimationFrame(()=>{this.minimize(),!Shopify.designMode&&c("minimal")}):(this.hide(),!Shopify.designMode&&!this.isPopupClosedStillAlive()&&c("hidden",!0))},isPopupClosedStillAlive:function(){let e=window.xParseJSONOTSB(localStorage.getItem(s()));return e===null||!e.ttl?!1:Date.now()>e.ttl&&i.delayDays!==0?(localStorage.removeItem(s()),!1):!0},hide:function(){this.show="hidden"},minimize:function(){this.show="minimal"},showFull:function(){this.show="full"},handleCloseMinimal:function(){v?.(this,l,r)!==!0&&(this.hide(),!Shopify.designMode&&!this.isPopupClosedStillAlive()&&c("hidden",!0))},handleClickMinimal:function(){b?.(this,l,r)!==!0&&requestAnimationFrame(()=>{this.showFull(),Shopify.designMode||c("full")})}}};window.otsb.loadedScript.includes("otsb-popup.js")||(document.addEventListener("alpine:init",()=>Alpine.data("otsb_xPopupV2",h)),window.otsb.loadedScript.push("otsb-popup.js"));})();
